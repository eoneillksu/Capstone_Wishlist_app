@using Capstone_Wishlist_app.Services
@using Capstone_Wishlist_app.Models
@model FindGiftsViewModel

@{
    ViewBag.Title = "Find Gifts";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Find Gifts for @Model.ChildFirstName</h2>
<ol class="breadcrumb">
    <li>
        <a href=@Url.Action("Index", "Home")>
            <i class="fa fa-home"></i>
            Home
        </a>
    </li>
    <li>
        <i class="fa fa-file-text"></i>
        Family Wishlists
    </li>
    <li>
        <a href=@Url.Action("ViewOwn", "Wishlist", new { id = Model.WishlistId })>
            @Model.ChildFirstName's Wishlist
        </a>
    </li>
    <li class="active">
        <i class="fa fa-search"></i>
        Find Gifts for @Model.ChildFirstName
    </li>
</ol>
<div class="row">

</div>
<div id="searchForm" class="form-horizontal">
    <div class="form-group">
        <label class="control-label col-md-2">Category</label>
        <div class="col-md-2">
            @Html.DropDownList("category", GetCategorySelectList(), new { @class = "form-control" })
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2">Key Words</label>
        <div class="col-md-4">
            @Html.TextBox("keywords", "", new { @class = "form-control", placeholder = "Enter words that describe the item" })
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-2 col-md-offset-2">
            <button class="btn btn-default" type="button" onclick="searchItemsByKeywords()">
                <i class="fa fa-search"></i>
                Find items by keyword
            </button>
        </div>
    </div>
    <br />
    <div class="form-group">
        <label class="control-label col-md-2">Retailer Link</label>
        <div class="col-md-6">
            @Html.TextBox("url", "", new { 
                @class = "form-control",
                placeholder = "Paste the address of the retailer's listing here",
                style = "max-width: 100%"})
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-2 col-md-offset-2">
            <button class="btn btn-default" type="button" onclick="getItemFromUrl()">
                <i class="fa fa-link"></i>
                Get the item from link
            </button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12" id="searchResults"></div>
</div>

<script type="text/javascript">
    var wishlistId = @Model.WishlistId

    function searchItemsByKeyword() {
        var $searchForm = $("#searchForm");
        var category = $("select[name=category]", $searchForm).val();
        var keywords = $("input[name=keywords]", $searchForm).val();

        $.get("/Wishlist/" + wishlistId + "/SearchItems", {
            category: category,
            keywords: keywords
        }, function (results) {
            $("#searchResults").html(results);
        }, "html");
    }

    function getItemFromUrl() {
        var getUrl = "@Url.Action("GetItemFromUrl", new { id = @Model.WishlistId })";
        var $searchForm = $("#searchForm");
        var itemUrl = $("input[name=url]", $searchForm).val();

        $.get(getUrl, { itemUrl: itemUrl }, function (results) {
            $("#searchResults").html(results);
        }, "html");
    }

    function addItemToWishlist(element, itemId) {
        $.post("/Wishlist/" + wishlistId + "/AddItem", {
            itemId: itemId
        }, function (data) {
            if (data.IsOnWishlist) {
                $(element).replaceWith('<p class="text-success"><span class="glyphicon glyphicon-check"></span>On wishlist!</p>');
            }
        }, "json");
    }
</script>

@functions{
    IEnumerable<SelectListItem> GetCategorySelectList() {
        return Enum.GetNames(typeof(ItemCategory))
            .Select(c => new SelectListItem {
                Text = c,
                Value = c
            });
    }
}



